import React from "react";
import { useNavigate, useParams } from "react-router-dom";
import { useDispatch, useSelector } from "react-redux";
import MenuAppBar from "../appbar";
import TnxFormContainer from "./index";
import SubmissionSteps from "./forms/SubmissionSteps";
import { createSample } from "./redux-saga/actions";

type SubmitPageProps = {};

const ranVerificationCode = () => {
  return Math.floor(1000000 + Math.random() * 9000000);
};

const SubmitPage = (props: SubmitPageProps) => {
  const navigate = useNavigate();
  const { uriTagNo, pending } = useParams();
  const [tagNo, setTagNo] = React.useState<string | null>(null);

  const { formActiveStep } = useSelector((state: DengueState) => state.dengue);
  const dispatch = useDispatch();
  const createNewSample = () => dispatch(createSample());

  const handleNew = () => {
    setActiveStep(0);
    navigate("/new-txn");
  };

  const handleBack = () => {
    // if (activeStep > 0) setActiveStep((prev) => prev - 1);
  };

  if (uriTagNo) {
    return (
      <>
        <MenuAppBar handleNew={handleNew} />
        <TxnDetails tagNo={uriTagNo} pending={pending ? pending : "false"} />
      </>
    );
  }

  if (tagNo) {
    return (
      <>
        <MenuAppBar handleNew={handleNew} />
        <SubmissionSteps
          tagNo={tagNo}
          handleBack={handleBack}
          activeStep={formActiveStep}
        />
      </>
    );
  }

  return (
    <>
      <MenuAppBar handleNew={handleNew} />
      <button onClick={() => setTagNo((old) => ranVerificationCode())}>
        get tag no
      </button>
    </>
  );
};

export default SubmitPage;
